# Emm42 V5.0 Plugin Standalone Tester

This directory contains comprehensive testing utilities for the Emm42 V5.0 stepper motor plugin. The tester allows you to verify plugin functionality without requiring actual hardware.

## Files Included

### Main Tester Scripts

1. **`test_emm42_quick.py`** - Quick verification script
   - Basic functionality test
   - Command overview
   - Response parsing examples
   - Perfect for initial verification

2. **`emm42_v5_simple_tester.py`** - Comprehensive test suite
   - All command categories
   - Parameter validation
   - Checksum testing
   - Detailed reporting

3. **`emm42_v5_tester.py`** - Advanced tester with serial simulation
   - Mock hardware interface
   - Real-time command testing
   - Background processes
   - Test report generation

## Quick Start

### Basic Verification
```bash
python test_emm42_quick.py
```

This will run a quick test to verify:
- ✓ Plugin loads correctly
- ✓ Commands generate proper byte sequences
- ✓ Response parsing works
- ✓ Human-readable output functions

### Comprehensive Testing
```bash
python emm42_v5_simple_tester.py
```

Options:
- `--info` - Show plugin information
- `--demo` - Run command demonstrations
- `--test basic` - Test basic commands only
- `--test read` - Test read commands only
- `--test modify` - Test modify commands only
- `--test checksum` - Test different checksum types
- `--test custom` - Test custom commands
- `--test all` - Run all tests (default)

### Advanced Testing with Serial Simulation
```bash
python emm42_v5_tester.py
```

Options:
- `--port COM3` - Specify serial port
- `--baudrate 9600` - Set baud rate
- `--real-hardware` - Use actual hardware instead of mock
- `--save-report` - Generate detailed JSON report
- `--test-single motor_enable` - Test single command
- `--address 1` - Set device address

## Plugin Features Tested

### Control Commands
- **motor_enable** - Enable/disable motor
- **speed_mode** - Continuous rotation control
- **position_mode** - Precise positioning
- **immediate_stop** - Emergency stop
- **sync_motion** - Multi-motor synchronization

### Homing Commands
- **trigger_homing** - Start homing sequence
- **stop_homing** - Force stop homing
- **set_zero_position** - Set current position as zero

### Read Commands (17 total)
- Motor status and position
- Encoder values and speed
- System parameters
- Error conditions
- Configuration settings

### Modify Commands (7 total)
- Subdivision settings
- Motor parameters
- Homing configuration
- Operating modes

### Utility Commands
- Encoder calibration
- Position reset
- Stall protection
- Factory reset

## Test Output Examples

### Quick Test Results
```
✓ Plugin imported successfully
✓ Plugin created: Emm42_V5.0
✓ Plugin has 37 commands
✓ Motor enable command: 01 F3 AB 01 00 6B
✓ Response parsed: Response to function code 0xF3
✓ Human readable: [OK] Command 0xF3 executed successfully. Address: 1
```

### Command Generation Example
```
Testing command: speed_mode
Parameters: {'address': 1, 'direction': 'CW', 'speed': 150, 'acceleration': 15}
Generated bytes: 01 F6 00 96 00 0F 00 6B
Mock response: 01 F6 02 6B
Human readable: [OK] Command 0xF6 executed successfully. Address: 1
```

### Response Parsing Example
```
Response: 01 3A 03 6B (Motor status)
Parsed: {'raw_data': '01 3A 03 6B', 'address': 1, 'func_code': 58}
Human readable: [Motor Status] Flags: Enabled, In Position (0x03)
```

## Checksum Support

The plugin supports three checksum methods:
- **fixed_0x6B** - Fixed value (default)
- **xor** - XOR of all bytes
- **crc8** - CRC-8 calculation

Example testing different checksums:
```bash
python emm42_v5_simple_tester.py --test checksum
```

## Human-Readable Response Parser

The plugin includes a comprehensive response parser that converts raw bytes into meaningful information:

- **Motor Status**: Enabled, Running, Direction, Position Reached
- **Position Data**: Steps and degrees conversion
- **Speed Data**: RPM with direction
- **Error Codes**: Detailed error descriptions
- **System Info**: Firmware version, configuration

## Custom Commands

Test custom hex commands:
```python
parameters = {
    'address': 1,
    'func_code': 0x06,
    'data': '45',
    'checksum_type': 'fixed_0x6B'
}
```

## Error Simulation

The tester includes comprehensive error simulation:
- Invalid commands
- Malformed responses
- Checksum mismatches
- Communication timeouts
- Parameter validation

## Real Hardware Testing

To test with actual hardware:
```bash
python emm42_v5_tester.py --real-hardware --port COM3 --baudrate 9600
```

**⚠️ Warning**: Only use real hardware testing if you understand the commands and have proper safety measures in place.

## Test Reports

Generate detailed JSON reports:
```bash
python emm42_v5_tester.py --save-report
```

Report includes:
- Test summary statistics
- Individual command results
- Response data and parsing
- Timing information
- Error details

## Plugin Architecture

The Emm42 V5.0 plugin follows the UART Plugin system architecture:

```python
class Plugin(UARTPlugin):
    def get_commands(self) -> Dict[str, Any]
    def process_command(self, command: str, parameters: Dict[str, Any]) -> bytes
    def parse_response(self, data: bytes) -> Dict[str, Any]
    def response_to_human_readable(self, data: bytes) -> str
    def validate_parameters(self, command: str, parameters: Dict[str, Any]) -> bool
```

## Troubleshooting

### Common Issues

1. **Import Error**: Ensure you're running from the correct directory
2. **Plugin Not Found**: Check that `plugins/emm42_v5.py` exists
3. **Serial Port Issues**: Use mock mode for testing without hardware
4. **Permission Errors**: Run with appropriate permissions for serial access

### Debug Mode

For verbose output, modify the test scripts to include debug prints:
```python
# Add at the top of any test script
import logging
logging.basicConfig(level=logging.DEBUG)
```

## Contributing

To extend the tester:

1. Add new test cases to the appropriate test functions
2. Implement additional mock responses for new commands
3. Enhance the human-readable parser for new response formats
4. Add validation for new parameter types

## License

This tester is part of the UART Command Sender project and follows the same licensing terms.
